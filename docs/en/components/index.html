<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components | api-shop</title>
    <meta name="description" content="api-shop: An easy-to-use, fast restful-api interface toolkit compatible with django / flask / bottle.">
    
    
    <link rel="preload" href="/api-shop/assets/css/0.styles.721593e8.css" as="style"><link rel="preload" href="/api-shop/assets/js/app.a43b8aec.js" as="script"><link rel="preload" href="/api-shop/assets/js/3.3dddc8e5.js" as="script"><link rel="preload" href="/api-shop/assets/js/11.b6451fb1.js" as="script"><link rel="prefetch" href="/api-shop/assets/js/10.42b6a5df.js"><link rel="prefetch" href="/api-shop/assets/js/12.f916b680.js"><link rel="prefetch" href="/api-shop/assets/js/13.a749ffd6.js"><link rel="prefetch" href="/api-shop/assets/js/14.5c66f789.js"><link rel="prefetch" href="/api-shop/assets/js/15.a6b48f8e.js"><link rel="prefetch" href="/api-shop/assets/js/16.6c78065a.js"><link rel="prefetch" href="/api-shop/assets/js/4.24977c1f.js"><link rel="prefetch" href="/api-shop/assets/js/5.e770d768.js"><link rel="prefetch" href="/api-shop/assets/js/6.1f91504f.js"><link rel="prefetch" href="/api-shop/assets/js/7.318f3fbd.js"><link rel="prefetch" href="/api-shop/assets/js/8.78701798.js"><link rel="prefetch" href="/api-shop/assets/js/9.aa4b8793.js"><link rel="prefetch" href="/api-shop/assets/js/vendors~docsearch.b010eae8.js">
    <link rel="stylesheet" href="/api-shop/assets/css/0.styles.721593e8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/api-shop/en/" class="home-link router-link-active"><!----> <span class="site-name">api-shop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/api-shop/en/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/pcloth/api-shop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api-shop/components/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/api-shop/en/components/" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/api-shop/en/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/pcloth/api-shop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/api-shop/components/" class="nav-link">简体中文</a></li><li class="dropdown-item"><!----> <a href="/api-shop/en/components/" class="nav-link router-link-exact-active router-link-active">English</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/api-shop/en/" class="sidebar-link">Home</a></li><li><a href="/api-shop/en/update/" class="sidebar-link">changelog</a></li><li><a href="/api-shop/en/start/" class="sidebar-link">Quick Start</a></li><li><a href="/api-shop/en/components/" class="active sidebar-link">components</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/api-shop/en/components/#apishop-class-component" class="sidebar-link">ApiShop Class component</a></li><li class="sidebar-sub-header"><a href="/api-shop/en/components/#api-class-component" class="sidebar-link">Api Class component</a></li><li class="sidebar-sub-header"><a href="/api-shop/en/components/#method-components" class="sidebar-link">Method components</a></li><li class="sidebar-sub-header"><a href="/api-shop/en/components/#func-model-extended-functions" class="sidebar-link">func.model extended functions</a></li><li class="sidebar-sub-header"><a href="/api-shop/en/components/#data-format-expansion" class="sidebar-link">data_format Expansion</a></li></ul></li><li><a href="/api-shop/en/docs/" class="sidebar-link">Documentation and mock tools</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="components"><a href="#components" aria-hidden="true" class="header-anchor">#</a> components</h1> <table><thead><tr><th style="text-align:left;">模块名字</th> <th style="text-align:center;">功能description</th> <th style="text-align:left;">模块介绍</th></tr></thead> <tbody><tr><td style="text-align:left;">ApiShop</td> <td style="text-align:center;">Api initialization class</td> <td style="text-align:left;">Used to load conf and options</td></tr> <tr><td style="text-align:left;">Api</td> <td style="text-align:center;">Business base class</td> <td style="text-align:left;">Used to inherit and write the actual business code</td></tr> <tr><td style="text-align:left;">get_api_result_json</td> <td style="text-align:center;">Call the business class directly</td> <td style="text-align:left;">return json,status_code</td></tr> <tr><td style="text-align:left;">get_api_result_response</td> <td style="text-align:center;">Call the business class directly</td> <td style="text-align:left;">return response</td></tr> <tr><td style="text-align:left;">data_format</td> <td style="text-align:center;">Built-in custom data format</td> <td style="text-align:left;">data_format.datetime Convert a string to datetime format</td></tr> <tr><td style="text-align:left;">data_format.DataExpansion</td> <td style="text-align:center;">Custom data foundation class</td> <td style="text-align:left;">Used to write custom data formats</td></tr></tbody></table> <h2 id="apishop-class-component"><a href="#apishop-class-component" aria-hidden="true" class="header-anchor">#</a> ApiShop Class component</h2> <div class="tip custom-block"><p>The api-shop core class, after instantiation, generates an interface object. You only need to access the instance method to call the corresponding business code.</p></div> <div class="language-python extra-class"><pre class="language-python"><code>ap <span class="token operator">=</span> ApiShop<span class="token punctuation">(</span>conf<span class="token punctuation">,</span>options<span class="token punctuation">)</span>
</code></pre></div><h3 id="apishop-conf-description"><a href="#apishop-conf-description" aria-hidden="true" class="header-anchor">#</a> ApiShop conf description</h3> <h4 id="apishop-conf-example"><a href="#apishop-conf-example" aria-hidden="true" class="header-anchor">#</a> ApiShop conf example</h4> <div class="language-python extra-class"><pre class="language-python"><code>conf <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
        <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'account.views.api_login'</span><span class="token punctuation">,</span>
        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'账户登录'</span><span class="token punctuation">,</span>
        <span class="token string">'methods'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'POST'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'用户名'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'密码'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string">'GET'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

</code></pre></div><h4 id="apishop-conf-description-2"><a href="#apishop-conf-description-2" aria-hidden="true" class="header-anchor">#</a> ApiShop conf description</h4> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Value Type</th> <th style="text-align:right;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">url</td> <td style="text-align:left;">str,list</td> <td style="text-align:right;">The url address of the interface only needs to fill in the relative address. If there are multiple urls, you can configure it as <code>list</code>. Support url parameter: <code>/api/url/&lt;id&gt;</code></td></tr> <tr><td style="text-align:left;">class</td> <td style="text-align:left;">str,class</td> <td style="text-align:right;">The business class actually invoked by the interface (inherited to Api), which can be an object or a reference address.</td></tr> <tr><td style="text-align:left;">name</td> <td style="text-align:left;">str</td> <td style="text-align:right;">Interface name</td></tr> <tr><td style="text-align:left;">methods</td> <td style="text-align:left;">dict</td> <td style="text-align:right;">Methods that the interface can receive: GET POST DELETE PUT PATCH</td></tr></tbody></table> <h3 id="apishop-conf-methods-description"><a href="#apishop-conf-methods-description" aria-hidden="true" class="header-anchor">#</a> ApiShop conf methods description</h3> <h4 id="apishop-conf-methods-description-2"><a href="#apishop-conf-methods-description-2" aria-hidden="true" class="header-anchor">#</a> ApiShop conf methods description</h4> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Value Type</th> <th style="text-align:right;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">name</td> <td style="text-align:left;">str</td> <td style="text-align:right;">parameter name, received in data.name</td></tr> <tr><td style="text-align:left;">type</td> <td style="text-align:left;">class</td> <td style="text-align:right;">str, int, float, bool, list, dict, tuple, etc., also supports the data_format.datetime time format, you can also customize a type converter</td></tr> <tr><td style="text-align:left;">required</td> <td style="text-align:left;">bool</td> <td style="text-align:right;">Is it necessary?</td></tr> <tr><td style="text-align:left;">default</td> <td style="text-align:left;">str,function</td> <td style="text-align:right;">When not received, the default value, note that it will also be converted by the type converter specified by type.When it is a function, if it does not receive the request parameter, it will automatically run this method to get the value, and will not perform type conversion.</td></tr> <tr><td style="text-align:left;">min</td> <td style="text-align:left;">int,str</td> <td style="text-align:right;">The minimum/minimum length, which is a string, is converted by the type converter specified by type.</td></tr> <tr><td style="text-align:left;">max</td> <td style="text-align:left;">int,str</td> <td style="text-align:right;">Maximum/maximum length, when a string is converted by the type converter specified by type.</td></tr> <tr><td style="text-align:left;">description</td> <td style="text-align:left;">str</td> <td style="text-align:right;">Description of the function, to see the contents of the document for the front-end personnel</td></tr> <tr><td style="text-align:left;">options</td> <td style="text-align:left;">list</td> <td style="text-align:right;">The value of the parameter must be in this list, for example: [1,4,7]. Receiving parameters outside this list will trigger bad_request</td></tr></tbody></table> <h3 id="apishop-options-description"><a href="#apishop-options-description" aria-hidden="true" class="header-anchor">#</a> ApiShop options description</h3> <h4 id="apishop-options-example"><a href="#apishop-options-example" aria-hidden="true" class="header-anchor">#</a> ApiShop options example</h4> <div class="language-python extra-class"><pre class="language-python"><code>options <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token string">'base_url'</span><span class="token punctuation">:</span><span class="token string">'/api/'</span><span class="token punctuation">,</span>
                <span class="token string">'bad_request'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                <span class="token string">'document'</span><span class="token punctuation">:</span> BASE_DIR <span class="token operator">+</span> <span class="token string">'/api_shop/static/document.html'</span><span class="token punctuation">,</span> 
                <span class="token string">'lang'</span><span class="token punctuation">:</span><span class="token string">'en'</span><span class="token punctuation">,</span>
                <span class="token string">'lang_pack'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</code></pre></div><h4 id="apishop-options-description-2"><a href="#apishop-options-description-2" aria-hidden="true" class="header-anchor">#</a> ApiShop options description</h4> <table><thead><tr><th style="text-align:left;">Key</th> <th style="text-align:left;">Type</th> <th style="text-align:left;">default</th> <th style="text-align:right;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">base_url</td> <td style="text-align:left;">str</td> <td style="text-align:left;">/api/</td> <td style="text-align:right;">interface url prefix</td></tr> <tr><td style="text-align:left;">bad_request</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">True</td> <td style="text-align:right;">If the request is not valid, return it as a bad request; otherwise it is all 200 return</td></tr> <tr><td style="text-align:left;">bad_request_error_status</td> <td style="text-align:left;">str, int, bool</td> <td style="text-align:left;">'error'</td> <td style="text-align:right;">If the bad_request parameter is set to False, then this parameter will be enabled and will be accompanied by a status='error' message in the bad request. You can customize this information.</td></tr> <tr><td style="text-align:left;">document</td> <td style="text-align:left;">str(path)</td> <td style="text-align:left;"></td> <td style="text-align:right;">The path to the html template of the document page, there will be a simple template by default</td></tr> <tr><td style="text-align:left;">lang</td> <td style="text-align:left;">str</td> <td style="text-align:left;">en</td> <td style="text-align:right;">Multi-language support, currently built in en, zh</td></tr> <tr><td style="text-align:left;">lang_pack</td> <td style="text-align:left;">dict</td> <td style="text-align:left;">None</td> <td style="text-align:right;">Extended language pack if you want api-shop to support more languages</td></tr> <tr><td style="text-align:left;">name_classification</td> <td style="text-align:left;">list</td> <td style="text-align:left;">none</td> <td style="text-align:right;">used for default document templates to filter interface names for easy searching</td></tr> <tr><td style="text-align:left;">url_classification</td> <td style="text-align:left;">list</td> <td style="text-align:left;">None</td> <td style="text-align:right;">Used by the default document template to filter the interface url for easy searching. Example: 'url_classification':['weixin', 'login']</td></tr> <tr><td style="text-align:left;">auto_create_folder</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">False</td> <td style="text-align:right;">Automatically create folder. The debug parameter must also be True to take effect.</td></tr> <tr><td style="text-align:left;">auto_create_file</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">False</td> <td style="text-align:right;">Automatically create files. The debug parameter must also be True to take effect.</td></tr> <tr><td style="text-align:left;">auto_create_class</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">False</td> <td style="text-align:right;">Automatically create class. The debug parameter must also be True to take effect.</td></tr> <tr><td style="text-align:left;">auto_create_method</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">False</td> <td style="text-align:right;">Automatically create method. The debug parameter must also be True to take effect.</td></tr> <tr><td style="text-align:left;">framework</td> <td style="text-align:left;">str</td> <td style="text-align:left;">None</td> <td style="text-align:right;">Manually specify the framework, currently supports django, flask, bottle, if not specified, the framework will be identified in order, if multiple frames are installed at the same time, please specify manually.</td></tr> <tr><td style="text-align:left;">debug</td> <td style="text-align:left;">bool</td> <td style="text-align:left;">True</td> <td style="text-align:right;">An error was thrown when loading the api business code.</td></tr></tbody></table> <h3 id="apishop-options-lang-pack-description"><a href="#apishop-options-lang-pack-description" aria-hidden="true" class="header-anchor">#</a> ApiShop options lang_pack description</h3> <h4 id="apishop-options-lang-pack-example"><a href="#apishop-options-lang-pack-example" aria-hidden="true" class="header-anchor">#</a> ApiShop options lang_pack example</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token string">'lang_pack'</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token string">'zh'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'no attributes found'</span><span class="token punctuation">:</span> <span class="token string">'没有找到属性：'</span><span class="token punctuation">,</span>
            <span class="token string">'not found in conf'</span><span class="token punctuation">:</span> <span class="token string">'在conf参数中没找到方法: '</span><span class="token punctuation">,</span>
            <span class="token string">'no such interface'</span><span class="token punctuation">:</span> <span class="token string">'没有这个接口'</span><span class="token punctuation">,</span>
            <span class="token string">'is required'</span><span class="token punctuation">:</span> <span class="token string">'是必要的'</span><span class="token punctuation">,</span>
            <span class="token string">'parameter'</span><span class="token punctuation">:</span> <span class="token string">'参数'</span><span class="token punctuation">,</span>
            <span class="token string">'can not be empty'</span><span class="token punctuation">:</span> <span class="token string">'不能为空'</span><span class="token punctuation">,</span>
            <span class="token string">'must be type'</span><span class="token punctuation">:</span> <span class="token string">'必须是类型'</span><span class="token punctuation">,</span>
            <span class="token string">'minimum length'</span><span class="token punctuation">:</span> <span class="token string">'最小长度'</span><span class="token punctuation">,</span>
            <span class="token string">'minimum value'</span><span class="token punctuation">:</span> <span class="token string">'最小值'</span><span class="token punctuation">,</span>
            <span class="token string">'maximum length'</span><span class="token punctuation">:</span> <span class="token string">'最大长度'</span><span class="token punctuation">,</span>
            <span class="token string">'maximum value'</span><span class="token punctuation">:</span> <span class="token string">'最大值'</span><span class="token punctuation">,</span>
            <span class="token string">'The wrong configuration, methons must be loaded inside the list container.'</span><span class="token punctuation">:</span> <span class="token string">'错误的配置，methons必须装的list容器内。'</span><span class="token punctuation">,</span>
            <span class="token string">'no such interface method'</span><span class="token punctuation">:</span> <span class="token string">'这个接口没有这个method'</span><span class="token punctuation">,</span>
            <span class="token string">'Framework version is not compatible.'</span><span class="token punctuation">:</span> <span class="token string">'api-shop不支持当前框架版本。'</span><span class="token punctuation">,</span>
            <span class="token string">'Not support'</span><span class="token punctuation">:</span> <span class="token string">'不支持'</span><span class="token punctuation">,</span>
            <span class="token string">'supported framework as follows:'</span><span class="token punctuation">:</span> <span class="token string">'支持的框架如下：'</span><span class="token punctuation">,</span>
            <span class="token string">'Did not find the framework'</span><span class="token punctuation">:</span><span class="token string">'没找指定的框架，请安装'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="api-class-component"><a href="#api-class-component" aria-hidden="true" class="header-anchor">#</a> Api Class component</h2> <div class="tip custom-block"><p>The api business code parent class, the business code you write must inherit it.</p></div> <h3 id="example"><a href="#example" aria-hidden="true" class="header-anchor">#</a> example</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop <span class="token keyword">import</span> Api

<span class="token keyword">class</span> <span class="token class-name">api_login</span><span class="token punctuation">(</span>Api<span class="token punctuation">)</span><span class="token punctuation">:</span>
     <span class="token triple-quoted-string string">&quot;&quot;&quot;User account login, the text here will be loaded into the document &quot;&quot;&quot;</span>
     <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token triple-quoted-string string">'''This is the get method of the request'''</span>
         Return

     <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token triple-quoted-string string">&quot;&quot;&quot;
         This is the post method of the request
         Data.username # username
         Data.ddd # Date
         &quot;&quot;&quot;</span>
         Return <span class="token punctuation">{</span><span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'Login successful'</span><span class="token punctuation">}</span>

     <span class="token keyword">def</span> <span class="token function">patch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token triple-quoted-string string">'''This is the patch method of the request'''</span>
         Return
    
     <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token triple-quoted-string string">'''This is the delete method of the request'''</span>
         Return
    
     <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token triple-quoted-string string">'''This is the put method of the request'''</span>
         Return
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">return value</p> <ul><li>The return value can be None, and the front end will receive a 200-state empty response, such as return None</li> <li>You can also specify a status code, such as return {'msg': 'error message'}, 400</li> <li>Of course, you can also return other data directly. return 1 The front end will receive a response with a body content of 1.</li></ul></div> <h3 id="parameter-request-description"><a href="#parameter-request-description" aria-hidden="true" class="header-anchor">#</a> parameter request description</h3> <blockquote><ul><li>Under normal circumstances, the incoming request is the reqeust of the current request.</li> <li>If you use the <code>get_api_result_json</code> or <code>get_api_result_response</code> method to call the business interface code, if the current request is not passed, the function will forge a fake request, only contains a method attribute, so in the business code, we do not recommend using the request directly. To deal with the problem.</li></ul></blockquote> <h3 id="parameter-data-description"><a href="#parameter-data-description" aria-hidden="true" class="header-anchor">#</a> parameter data description</h3> <blockquote><ul><li>The data object is the check parameter dict, which can access the data content through the attribute, for example: data.name</li></ul></blockquote> <h2 id="method-components"><a href="#method-components" aria-hidden="true" class="header-anchor">#</a> Method components</h2> <h3 id="get-api-result-json-method"><a href="#get-api-result-json-method" aria-hidden="true" class="header-anchor">#</a> get_api_result_json method</h3> <div class="tip custom-block"><ul><li>Call the business code class directly to get the return data and status code</li> <li>Please note: All parameters must be filled in the data due to parameter monitoring bypassed.</li></ul></div> <h4 id="flask-example"><a href="#flask-example" aria-hidden="true" class="header-anchor">#</a> flask example</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop <span class="token keyword">import</span> get_api_result_json

<span class="token keyword">from</span> views <span class="token keyword">import</span> api_login <span class="token comment"># Inherited the business code of the Api class</span>

<span class="token decorator annotation punctuation">@simple_page<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    data <span class="token operator">=</span> get_api_result_json<span class="token punctuation">(</span>
        api_login<span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'testuser'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'12345'</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment"># This way, the business code can be quickly called inside the program.</span>

</code></pre></div><div class="tip custom-block"><p class="custom-block-title">get_api_result_json parameter description</p> <ul><li>get_api_result_json(api_class, method, data=None, request=None, not200=True)</li> <li>Call the api code directly and get the return json
<ul><li>api_class Is the object of the business api class (not an instance)</li> <li>method Is the request method, str format</li> <li>data Is additional data, dict format</li> <li>request=None Is the current request, if the method and request.method are not the same, please encapsulate a request for business code, if the business code does not need reqeust, please do not pass.</li> <li>not200=True Is to allow the status_code is not equal to 200 results, when it is False, it encounters a program interrupt other than 200 and throws a mistake.</li></ul></li> <li>return json,status_code</li></ul></div> <h3 id="get-api-result-response-method"><a href="#get-api-result-response-method" aria-hidden="true" class="header-anchor">#</a> get_api_result_response method</h3> <div class="tip custom-block"><ul><li>Call the business code class directly, get the response packet response</li> <li>Please note: All parameters must be filled in the data due to parameter monitoring bypassed.</li></ul></div> <h4 id="flask-example-2"><a href="#flask-example-2" aria-hidden="true" class="header-anchor">#</a> flask example</h4> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop <span class="token keyword">import</span> get_api_result_response

<span class="token keyword">from</span> views <span class="token keyword">import</span> api_login 

@simple_page<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    response <span class="token operator">=</span> get_api_result_response<span class="token punctuation">(</span>
        api_login<span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'testuser'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'12345'</span><span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> 

</code></pre></div><div class="tip custom-block"><p>Same as the <code>get_api_result_json</code> method, but the return value of <code>get_api_result_response</code> is a response</p></div> <h2 id="func-model-extended-functions"><a href="#func-model-extended-functions" aria-hidden="true" class="header-anchor">#</a> func.model extended functions</h2> <h3 id="func-model-loads-write-dict-data-to-orm-stencil"><a href="#func-model-loads-write-dict-data-to-orm-stencil" aria-hidden="true" class="header-anchor">#</a> func.model.loads write dict data to ORM stencil</h3> <div class="tip custom-block"><p>The loads method accepts two parameters:</p> <p>@model_obj ORM mold object instance</p> <p>@dict_data The dict data that needs to be updated</p></div> <h3 id="func-model-dumps-convert-the-data-of-orm-mold-to-json-format"><a href="#func-model-dumps-convert-the-data-of-orm-mold-to-json-format" aria-hidden="true" class="header-anchor">#</a> func.model.dumps Convert the data of ORM mold to json format</h3> <div class="tip custom-block"><p>The dumps method receives the following parameters:</p> <p>@model_obj data stencil
     @exclude does not process fields in the list
         Default exclude = ['_sa_instance_state', 'password_hash', '_state', 'password']
         Output password fields are not processed by default
     @include outputs only the fields in the list
     @string directly converted to string format
     @func default output attribute method in stencil class</p></div> <h3 id="loads-and-dumps-usage-example"><a href="#loads-and-dumps-usage-example" aria-hidden="true" class="header-anchor">#</a> loads and dumps usage example</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop <span class="token keyword">import</span> func<span class="token punctuation">,</span>Api
<span class="token keyword">from</span> models <span class="token keyword">import</span> Users
<span class="token keyword">class</span> <span class="token class-name">users</span><span class="token punctuation">(</span>Api<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> Users<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Users<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> data<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ret <span class="token operator">=</span> func<span class="token punctuation">.</span>models<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token comment"># Convert ORM data to json format for front-end use.</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span>ret<span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        user <span class="token operator">=</span> Users<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Users<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> data<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

        func<span class="token punctuation">.</span>models<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>user<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token comment"># Append the data contained in data to the user</span>

        user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="func-model-models-to-list-convert-the-query-orm-instance-list-into-a-json-list"><a href="#func-model-models-to-list-convert-the-query-orm-instance-list-into-a-json-list" aria-hidden="true" class="header-anchor">#</a> func.model.models_to_list convert the query ORM instance list into a json list</h3> <div class="tip custom-block"><p>Equivalent to [func.model.dumps (x) for x in models]</p></div> <h2 id="data-format-expansion"><a href="#data-format-expansion" aria-hidden="true" class="header-anchor">#</a> data_format Expansion</h2> <div class="tip custom-block"><p class="custom-block-title">Data format extension</p> <ul><li>data_format.datetime Can be used to fill in the type in the conf.methods parameter list, convert the string <code>&quot;2019-01-01 08:30:00&quot;</code> in the request parameter to datetime format</li> <li>data_format.DataExpansion Custom extension base class</li></ul></div> <h3 id="data-format-datetime"><a href="#data-format-datetime" aria-hidden="true" class="header-anchor">#</a> data_format.datetime</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop <span class="token keyword">import</span> data_format
conf <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'url'</span><span class="token punctuation">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
        <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'account.views.api_test'</span><span class="token punctuation">,</span>
        <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'测试方法'</span><span class="token punctuation">,</span>
        <span class="token string">'methods'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'POST'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'time'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> data_format<span class="token punctuation">.</span>datetime<span class="token punctuation">,</span> <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token string">'2018-01-01'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token string">'2019-12-31'</span><span class="token punctuation">,</span> <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'时间'</span><span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="when-submitting-the-request-the-incoming-time-parameter-will-be-converted-to-datetime-format-and-check-whether-it-is-greater-than-or-equal-to-january-1-2018-less-than-or-equal-to-december-31-2019"><a href="#when-submitting-the-request-the-incoming-time-parameter-will-be-converted-to-datetime-format-and-check-whether-it-is-greater-than-or-equal-to-january-1-2018-less-than-or-equal-to-december-31-2019" aria-hidden="true" class="header-anchor">#</a> When submitting the request, the incoming time parameter will be converted to datetime format, and check whether it is greater than or equal to January 1, 2018, less than or equal to December 31, 2019.</h4> <h3 id="data-format-regex-regular-format-check"><a href="#data-format-regex-regular-format-check" aria-hidden="true" class="header-anchor">#</a> data_format.regex regular format check</h3> <p>The uploaded string will be checked regularly.
Call method:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> src<span class="token punctuation">.</span>api_shop <span class="token keyword">import</span> data_format

conf <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'url'</span><span class="token punctuation">:</span><span class="token string">'test'</span><span class="token punctuation">,</span>
        <span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'business_code.views.api_test'</span><span class="token punctuation">,</span>
        <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Test interface'</span><span class="token punctuation">,</span>
        <span class="token string">'methods'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'POST'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'email'</span><span class="token punctuation">,</span>
                    <span class="token string">'type'</span><span class="token punctuation">:</span> data_format<span class="token punctuation">.</span>regex<span class="token punctuation">(</span>
                        <span class="token string">r'^[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+){0,4}@[a-zA-Z0-9_-]+(\.[ a-zA-Z0-9_-]+){0,4}$'</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'mailbox'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
                    <span class="token string">'min'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                    <span class="token string">'max'</span><span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                    <span class="token string">'description'</span><span class="token punctuation">:</span><span class="token string">'Mailbox'</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'idcard'</span><span class="token punctuation">,</span><span class="token string">'type'</span><span class="token punctuation">:</span> data_format<span class="token punctuation">.</span>idcard<span class="token punctuation">,</span><span class="token string">'required'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'description'</span><span class="token punctuation">:</span><span class="token string">'ID card'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="built-in-more-fast-regular-check"><a href="#built-in-more-fast-regular-check" aria-hidden="true" class="header-anchor">#</a> Built-in more fast regular check</h3> <p>-data_format.numeric numeric string
-email
-data_format.chinese in Chinese
-data_format.url url format
-data_format.cellphone mobile number
-data_format.idcard ID number</p> <h3 id="data-format-dataexpansion-custom-data-type"><a href="#data-format-dataexpansion-custom-data-type" aria-hidden="true" class="header-anchor">#</a> data_format.DataExpansion custom data type</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> api_shop<span class="token punctuation">.</span>data_format <span class="token keyword">import</span> DataExpansion
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime <span class="token keyword">as</span> dt

<span class="token keyword">class</span> <span class="token class-name">datetime</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span>metaclass<span class="token operator">=</span>DataExpansion<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''Convert str to datetime format'''</span>
    
    class_name <span class="token operator">=</span> <span class="token string">&quot;&lt;class'data_format.datetime'&gt;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        i<span class="token string-interpolation"><span class="token string">f':'</span></span> <span class="token keyword">in</span> string<span class="token punctuation">:</span>
            <span class="token keyword">return</span> dt<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>string<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d %H:%M:%S'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> dt<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>string<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
</code></pre></div><div class="tip custom-block"><p>When inheriting, please follow the above writing, inherit as a metaclass, and directly use the <strong>new</strong> method to return a new format</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/4/2020, 9:17:57 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/api-shop/en/start/" class="prev">
          Quick Start
        </a></span> <span class="next"><a href="/api-shop/en/docs/">
          Documentation and mock tools
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/api-shop/assets/js/app.a43b8aec.js" defer></script><script src="/api-shop/assets/js/3.3dddc8e5.js" defer></script><script src="/api-shop/assets/js/11.b6451fb1.js" defer></script>
  </body>
</html>
