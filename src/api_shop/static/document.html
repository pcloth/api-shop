<!-- {% verbatim %} -->
<link href="https://unpkg.com/element-ui@2.4.11/lib/theme-chalk/index.css" rel="stylesheet">
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui@2.4.11/lib/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.bootcss.com/Mock.js/1.0.1-beta3/mock-min.js"></script>
<script src="https://cdn.bootcss.com/clipboard.js/2.0.4/clipboard.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<!-- ApiFactory -->
<style>
    body {
        margin: 0;
        background-color: #E9EEF3;
    }

    @font-face {
        font-family: "iconfont";
        src: url('data:application/x-font-woff2;charset=utf-8;base64,d09GMgABAAAAAAPUAAsAAAAAB7QAAAOGAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHEIGVgCCZgqDSIMgATYCJAMICwYABCAFhG0HMBu8BlGUDUqV7IckyQMoPbwnQscgUIQECgAoAAAAG4B4+Nrvd+6+/YhYUo2iiUQiRPESSCQNldLpDNM1NDLJ3tZ0YUyFkDnPlqg11fQd+e/+XpoyzmM8wqEUQoJwHNnlfCC4+irkXhcAqtjxf+7n6yLt6SzvgucUWZSphQMc7/jOgKKLbB/og/GnvxwOrxqPru0E6gxpK+yY7E9Ql0G/QJyFawvqKaNckx9qhKqSqTnFLWI16Tq94Mb/+fiyGDUklQJw7x0sXBiXSYTJZTIvF0U0nh3iLApMA5nYLXXuKIWRaSV1+qSyHiBJUP7bf3gBUQVyG8AAiYTmeCaSU/7NBDJq8Qg89cpkZm2FOJ4Y0gJTsGSk4djisAOMQPJ+E6f8Ro7CSg6XlFJ0ROHQ0trWHC7lkKOUpYqzrLKxX6herHBwEM37TxdqFWkcrC9nL+HOZyuuhuSDmQnhFed8JqZ8gJ78+no0OsoiUdjYWMiUn89cUNDAmlR0jFBiTayQnE8oLIUUhwgu5SgtuoC5gElhBQoXR+kc8nlDijT2aamQMwCSS87479L0mUeM2iFkNxrhKF/klhDvY8be08PHKUYMO7VRJRlKRNytkrwyJrTWuQ2HdpIsEpGdse17Xz0LqsyKjko7bbEbZuakVAqX9bX3/LIMJoR5Fhp6hNGuFSqEpIp5KoEspDwXSk6qhm/o4ImXf6W5cu/tOxfl6PazJZGJPeijIzJnj/fxSFQocoqwG0VozM6huLqcbxm8FOra2hkGLqqaGpu2jRvtHYwiZvWm5qbW2qIWMAbK77Kw+BHiH7efh0/HfN/mle+a+gxedeGTL2hHztyg5h5dwW+ql3P5Q5YkYEhZE9QUBpJH5O9AXkf9lADeNr++7k4Q20ONJMKQVBuEQo1hdMZPQ0W9ZahSYx3qTFnNrteOlUSuxaQngtDiDUmTJyi0+KAz/gsVXf5QpSUKqLMf7UvWG41jim08WUIu2g/0HZMoZpFmkH8gnUcWJyU+9UKc+X4cyMhl4ytKiMcYkV31UEShYhPjEu1GUWQwZROQI11PJB31ZEPKPtR1TAxN2xixCOJCtgfkcxgJ5VYXzdz3D4iWi1i4pqzOe0FYxm8cDXT1W6BXyqRV2bXckrnShoRQkMKMGFoiO4loxEBpeacAcYgur0coNdIjlVRbZXd+dfx0a6AO6FLQdoWqw3DxchsAAAA=') format('woff2');
    }

    .iconfont {
        font-family: "iconfont" !important;
        font-size: 18px;
        color: #333;
        font-style: normal;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    .icon-github:before {
        content: "\f01ca";
    }

    /* .el-header,
    .el-footer {
        line-height: 1;
        height: 70px;
        background-color: #fff;
        margin-bottom: 20px;
        justify-content: center;
    } */

    .el-aside .el-table th,
    .el-aside .el-table tr {
        background-color: #D3DCE6;
    }

    .el.el-header {
        text-align: center;
    }

    .el-footer {
        margin-top: 20px;
    }

    .el-aside {
        background-color: #D3DCE6;
        color: #333;
        text-align: center;
    }

    .el-main {
        background-color: #E9EEF3;
        color: #333;
        text-align: center;
        padding: 10px;
    }

    .flex-row {
        display: flex;
        align-items: center;
        margin: 20px 0;
    }

    .flex-row:hover {
        background-color: #f5f7fa;
    }

    .flex-row-title {
        width: 100px;
        text-align: left;
    }

    .flex-row-content {
        flex: 1;
        margin-left: 20px;
    }

    .el-table__empty-block {
        height: auto;
    }

    .color-line {
        height: 5px;
        background-color: rgb(179, 209, 205);
    }

    .api-list {}

    .row {
        display: flex;
        flex: 1 1 100%;
        padding: 0px 10px;
        height: 2rem;
        line-height: 2rem;
        cursor: pointer;
    }

    .row.selected {
        background-color: #c6e2ff;
        pointer-events: none;
    }

    .row:hover {
        background-color: rgb(255, 255, 255, 0.5);
        color: #000;

    }

    .col {
        width: 50%;
        display: flex;
        justify-content: flex-start;
    }

    .line {
        display: flex;

    }
</style>
<div id="app">
    <template>
        <el-container style="    height: 100%;">
            <el-container>
                <el-aside width="300px">
                    <img src="https://pcloth.github.io/api-shop/logo.png" alt="logo" style="margin-top:20px">
                    <h4>ver: {{options.version}}
                        <a href="https://pcloth.github.io/api-shop/" target="_blank"
                            :title="_('View api-shop documentation')">
                            <i class="el-icon-document" style="font-size: 18px;color: #000;"></i>
                        </a>
                        <a href="https://github.com/pcloth/api-shop" target="_blank"
                            :title="_('Access code repository')"><span class="iconfont icon-github"></span></a>
                    </h4>
                    <h5>{{_('api count')}}: {{apiList.length}}</h5>
                    <div class="api-list">
                        <div class="row" style="margin-bottom: 20px;">
                            <div class="col">
                                <el-select v-model="seleledName" filterable placeholder="请选择">
                                    <el-option :label="_('Name')" value=""></el-option>
                                    <el-option v-for="item in name_type" :key="`name-type-${item.value}`"
                                        v-if="item.text" :label="item.text" :value="item.value">
                                    </el-option>
                                </el-select>
                            </div>
                            <div class="col">
                                <el-select v-model="seleledUrl" filterable placeholder="请选择">
                                    <el-option :label="_('Url')" value=""></el-option>
                                    <el-option v-for="item in url_type" :key="`url-type-${item.value}`" v-if="item.text"
                                        :label="item.text" :value="item.value">
                                    </el-option>
                                </el-select>
                            </div>
                        </div>

                        <div class="row" :class="{selected:$route.params.idx==idx}" v-for="(api,idx) in apiList"
                            :style="typeof api.url==='string'?'':`height:${api.url.length*2}rem;`" v-show="filter(api)"
                            @click="viewDocument(idx)" :key="`api-menu-${idx}`">
                            <div class="col">{{api.name}}</div>
                            <div class="col" v-if="typeof api.url==='string'">{{api.url}}</div>
                            <div class="col" style="flex-direction: column;" v-else>
                                <div class="line" v-for="(url,i) in api.url" :key="`tb_url_${i}`">
                                    {{url}}
                                </div>
                            </div>
                        </div>
                    </div>
                </el-aside>
                <el-main>
                    <router-view></router-view>
                </el-main>
            </el-container>
        </el-container>
    </template>
</div>
<script>
    var data = {
        apiList: [],

        options: {},

        baseUrl: '',
        name_type: [],
        url_type: [],
    }

    const i18n = {
        zh: {
            'api count': '当前api数量',
            'View api-shop documentation': '查看api-shop文档',
            'Access code repository': '访问代码仓库',
            'Name': '接口名',
            'Url': '地址',
            'Main document': '主文档',
            'copy': '复制',
            'Method Document': '方法文档',
            'None': '无',
            'No parameters required': '无须参数',
            'name': '参数名',
            'type': '类型',
            'required': '必要',
            'minimum': '最小值/长度',
            'maximum': '最大值/长度',
            'test value': '测试值',
            'description': '描述',
            'Mock Test': '模拟测试',
            'default': '默认值',
            'options':'可选项'
        },
        en: {
            'api count': 'api count',
            'View api-shop documentation': 'View api-shop documentation',
            'Name': 'Name',
            'Url': 'Url',
            'Main document': 'Main document',
            'copy': 'copy',
            'Method Document': 'Method Document',
            'None': 'None',
            'No parameters required': 'No parameters required',
            'name': 'name',
            'type': 'type',
            'required': 'required',
            'minimum': 'minimum',
            'maximum': 'maximum',
            'test value': 'test value',
            'description': 'description',
            'Mock Test': 'Mock Test',
            'default': 'default',
            'options':'options'
        }
    }


    const interface = {
        name: 'interface',
            template: `<el-row><el-row v-if="currentApi">\
            <div class="flex-row">\
                <div class="flex-row-title">{{_('Name')}} </div>\
                <div class="flex-row-content">\
                    <el-input readonly v-model="currentApi.name">\
                    </el-input>\
                </div>\
            </div>\
            <div class="flex-row">\
                <div class="flex-row-title">{{_('Url')}}</div>\
                <div class="flex-row-content" v-show="currentApi.url">\
                    <el-input v-if="typeof currentApi.url==='string'" id="api-url"\
                        :value="baseUrl+currentApi.url">\
                        <el-button id="copy" slot="append" :data-clipboard-text="baseUrl+currentApi.url">\
                            {{_('copy')}}\
                        </el-button>\
                    </el-input>\
                    <div v-else>\
                        <el-input id="api-url" v-for="(url,i) in currentApi.url" :value="baseUrl+url"\
                            :key="'url_'+i">\
                            <el-button id="copy" slot="append" :data-clipboard-text="baseUrl+url">\
                                {{_('copy')}}\
                            </el-button>\
                        </el-input>\
                    </div>\
                </div>\
            </div>\
            <div class="flex-row">\
                <div class="flex-row-title">{{_('Main document')}}</div>\
                <div class="flex-row-content">\
                    <el-input readonly type="textarea" autosize v-model="currentApi.document">\
                    </el-input>\
                </div>\
            </div>\
            <div v-if="currentApi.methods">\
                <div v-for="(method,key) in currentApi.methods" :key="key">\
                    <div class="color-line"></div>\
                    <div class="flex-row">\
                        <div class="flex-row-title">{{key}}</div>\
                        <div class="flex-row-content">\
                            <div class="flex-row">\
                                <div class="flex-row-title" style="width:150px;">\
                                    <el-button type="primary" style="float: left;margin: 10px 0;"\
                                        @click="mockTest(method,key)">\
                                        {{_('Mock Test')+key}}\
                                    </el-button>\
                                </div>\
                                <div class="flex-row-content">\
                                    <div>{{key}} {{_('Method Document')}}</div>\
                                    <el-input\
                                        v-if="currentApi.methods_documents && currentApi.methods_documents[key]"\
                                        readonly type="textarea" autosize\
                                        v-model="currentApi.methods_documents[key]">\
                                    </el-input>\
                                    <div v-else>-{{_('None')}}-</div>\
                                </div>\
                            </div>\
                            <div class="flex-row">\
                                <el-table :data="method" :empty-text="_('No parameters required')" stripe\
                                    style="height:auto;">\
                                    <el-table-column prop="name" :label="_('name')">\
                                    </el-table-column>\
                                    <el-table-column prop="type" :label="_('type')">\
                                    </el-table-column>\
                                    <el-table-column prop="required" :label="_('required')">\
                                        <template slot-scope="scope">\
                                            <el-checkbox v-model="scope.row.required"\
                                                style="pointer-events: none;"></el-checkbox>\
                                        </template>\
                                    </el-table-column>\
                                    <el-table-column prop="default" :label="_('default')">\
                                    </el-table-column>\
                                    <el-table-column prop="options" :label="_('options')">\
                                        <template slot-scope="scope">\
                                            <div v-if="scope.row.options">\
                                                <el-tag style="margin-right:10px;" v-for="(item,i) in scope.row.options" :key="i">{{item}}</el-tag>\
                                            </div>\
                                        </template>\
                                    </el-table-column>\
                                    <el-table-column prop="min" :label="_('minimum')" width="120">\
                                    </el-table-column>\
                                    <el-table-column prop="max" :label="_('maximum')" width="120">\
                                    </el-table-column>\
                                    <el-table-column fixed prop="value" :label="_('test value')"\
                                        width="100">\
                                        <template slot-scope="scope">\
                                            <el-input v-model="scope.row.value"></el-input>\
                                        </template>\
                                    </el-table-column>\
                                    <el-table-column prop="description" :label="_('description')">\
                                    </el-table-column>\
                                </el-table>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            </div>\
        </el-row></el-row>`,
            props: ['idx'],

            data() {
                return {
                    test: 'ceshi',
                    currentApi: {},
                    testData: {},
                    ttt: 0,

                    // i18n:i18n
                }
            },
            computed: {
                // 计算属性的 getter
                testString() {
                    return JSON.stringify(this.testData);
                },
                apiList() {
                    // this.ttt
                    return data.apiList;
                },

                options() {
                    // this.ttt
                    return data.options;
                },
                baseUrl() {
                    // this.ttt
                    return data.baseUrl;
                },
                name_type() {
                    // this.ttt
                    return data.name_type;
                },
                url_type() {
                    // this.ttt
                    return data.url_type;
                },
            },
            updated() {
                this.readApi();
            },
            mounted() {
                this.readApi();
                // this.$nextTick(_ => {
                    
                // });
            },
            methods: {
                _(text) {
                    let lang = data.options.lang ? data.options.lang : 'en'
                    return i18n[lang][text] ? i18n[lang][text] : text;
                },
                readApi() {
                    console.log(this.idx,'>>>')
                    if (!data.apiList || data.apiList.length == 0) {
                        setTimeout(this.readApi, 500);
                    }
                    this.testData = Mock.mock({
                        "string|1-10": "★"
                    });
                    this.currentApi = data.apiList[this.idx];
                },
                mockTest(method, key) {
                    let api_url = ''
                    if (typeof this.currentApi.url === 'string') {
                        api_url = this.currentApi.url

                    } else {
                        api_url = this.currentApi.url[0]

                    }
                    let url = this.options.base_url + api_url;
                    this.$alert('请打开F12查看发送情况。', '提示')
                    let mapping = {
                        str: '@string',
                        int: '@integer',
                        float: '@float',
                        bool: '@boolean',
                        list: '@range',
                        set: '@range',
                        "api_shop.data_format.datetime": '@datetime'
                    }
                    let mockConf = {}
                    for (let i in method) {

                        if (method[i].value) {
                            mockConf[method[i].name] = method[i].value;
                        } else if (!method[i].required) {
                            continue;
                        } else {
                            let min = method[i].min ? method[i].min : 1;
                            let max = method[i].max ? method[i].max : 20;
                            let length = getRandomInt(min, max);
                            let val = mapping[method[i].type] ? mapping[method[i].type] : '@character'
                            if (method[i].type == 'list' || method[i].type == 'set') val = `${val}(${length})`;
                            if (method[i].type == 'str') val = `${val}("lower",${length})`;
                            if (method[i].type == 'int' || method[i].type == 'float') val = `${val}(${min},${max})`;
                            mockConf[method[i].name] = Mock.mock(val);

                        }

                        if (mockConf[method[i].name] && url.indexOf(`<${method[i].name}>`) >= 0) {
                            // console.log(method[i].name,mockConf[method[i].name])
                            url = url.replace(`<${method[i].name}>`, mockConf[method[i].name])
                            // console.log(url)
                            mockConf[method[i].name] = undefined
                        }

                    }
                    console.log('发送mock数据包', mockConf, key)

                    if (key == 'GET' || key == 'DELETE') mockConf = {
                        params: mockConf
                    };

                    axios[key.toLowerCase()](url, mockConf).then(res => {
                        console.log('mock数据访问api成功：', res);
                    }).catch(error => {
                        console.log('mock数据访问api失败：', error);
                    })

                },
            },
    }

    const routes = [{
        path: '/interface/:idx',
        component: interface,
        props: true
    }, ]


    const router = new VueRouter({
        routes
    })

    function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function ajax(method, url, data) {
        let ajaxObject = {
            url: url,
            method: method,
            timeout: 30000,

        }
        if (method == 'get' || method == 'delete') {
            ajaxObject.params = data
        } else {
            ajaxObject.headers = {
                'X-Requested-With': 'XMLHttpRequest'
            }
            ajaxObject.data = data
        }
        return axios(ajaxObject)
    }


    var Main = {
        router,
        data() {
            return {
                // apiCount: 100,
                ttt: 0,
                testData: {},
                currentApi: {},
                i18n: i18n,
                seleledName: '',
                seleledUrl: ''
            }
        },
        computed: {
            // 计算属性的 getter
            testString() {
                return JSON.stringify(this.testData);
            },
            apiList() {
                this.ttt
                return data.apiList;
            },

            options() {
                this.ttt
                return data.options;
            },
            baseUrl() {
                this.ttt
                return data.baseUrl;
            },
            name_type() {
                this.ttt
                return data.name_type;
            },
            url_type() {
                this.ttt
                return data.url_type;
            },
        },
        created() {
            data.baseUrl = window.location.pathname.split('document')[0];
            this.getApi();

        },
        mounted() {
            var clipboard = new ClipboardJS('#copy');
            let that = this;
            clipboard.on('success', function (e) {
                that.$notify({
                    title: '成功',
                    message: `已经将 ${e.text} 复制到粘贴板。`,
                    type: 'success'
                });
                e.clearSelection();
            });
        },

        methods: {
            _(text) {
                let lang = this.options.lang ? this.options.lang : 'en'
                return this.i18n[lang][text] ? this.i18n[lang][text] : text;
            },
            getApi() {
                ajax('get', `${data.baseUrl}api_data`)
                    .then((res) => {
                        data.apiList = res.data.data;
                        data.options = res.data.options;

                        if (data.options.name_classification) this.make_filter_data('name_type', data.options
                            .name_classification);
                        if (data.options.url_classification) this.make_filter_data('url_type', data.options
                            .url_classification);
                        this.ttt += 1;
                    })
                    .catch((error) => {
                        console.log('error', error);
                    });


            },
            make_filter_data(obj, data) {
                data[obj] = [];
                for (let i in data) {
                    if (typeof data[i] === 'string') {
                        this[obj].push({
                            text: data[i],
                            value: data[i]
                        })
                    }
                }
            },
            
            filter(api) {
                if (!this.seleledName && !this.seleledUrl) return true;
                if (this.seleledName && api.name.indexOf(this.seleledName) >= 0) return true;
                if (this.seleledUrl) {
                    if (typeof api.url === 'string') {
                        if (api.url.indexOf(this.seleledUrl) >= 0) return true;
                    } else {
                        for (let i in api.url) {
                            if (api.url[i].indexOf(this.seleledUrl) >= 0) return true;
                        }
                    }
                }
                return false;
            },

            viewDocument(api) {
                console.log('route')
                this.$router.push('/interface/' + api)
                this.$forceUpdate();
            },




        }
    }
    // Vue.prototype.$ELEMENT = { size: 'mini'};

    const app = new Vue(Main).$mount('#app')
</script>
<!-- {% endverbatim %} -->